---
section: "data acquisition"
title: "data download"
---

```python
from kaggle.api.kaggle_api_extended import KaggleApi
import os
import shutil
import pandas as pd

```


    ---------------------------------------------------------------------------

    ModuleNotFoundError                       Traceback (most recent call last)

    <ipython-input-5-16502cad22d7> in <module>
          3 import shutil
          4 import pandas as pd
    ----> 5 import py7zr
    

    ModuleNotFoundError: No module named 'py7zr'



```python
api = KaggleApi() # Initializes Kaggle API
api.authenticate() # Authenticates with Kaggle auth
```

    Warning: Your Kaggle API key is readable by other users on this system! To fix this, you can run 'chmod 600 /home/jovyan/.kaggle/kaggle.json'
    

## Members


```python
# Downloads necessary file and extract
api.competition_download_file('kkbox-churn-prediction-challenge', 'members_v3.csv.7z')

# Full path of  
# the archive file 
filename = "members_v3.csv.7z"
  
# Target directory 
extract_dir = "."
  
# Format of archie file 
archive_format = "7z"
  
# Unpack the archive file  
shutil.unpack_archive(filename, extract_dir, archive_format)  
print("Archive file unpacked successfully.") 
```

    members_v3.csv.7z: Skipping, found more recently modified local copy (use --force to force download)
    


    ---------------------------------------------------------------------------

    ValueError                                Traceback (most recent call last)

    <ipython-input-6-e02459ec2e08> in <module>
         13 
         14 # Unpack the archive file
    ---> 15 shutil.unpack_archive(filename, extract_dir, archive_format)
         16 print("Archive file unpacked successfully.")
    

    /opt/conda/lib/python3.8/shutil.py in unpack_archive(filename, extract_dir, format)
       1213             format_info = _UNPACK_FORMATS[format]
       1214         except KeyError:
    -> 1215             raise ValueError("Unknown unpack format '{0}'".format(format)) from None
       1216 
       1217         func = format_info[1]
    

    ValueError: Unknown unpack format '7z'



```python
# Read CSV into dataframe
df = pd.read_csv('members_v3.csv', low_memory=False)
```


```python
df.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>msno</th>
      <th>city</th>
      <th>bd</th>
      <th>gender</th>
      <th>registered_via</th>
      <th>registration_init_time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Rb9UwLQTrxzBVwCB6+bCcSQWZ9JiNLC9dXtM1oEsZA8=</td>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>11</td>
      <td>20110911</td>
    </tr>
    <tr>
      <th>1</th>
      <td>+tJonkh+O1CA796Fm5X60UMOtB6POHAwPjbTRVl/EuU=</td>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>7</td>
      <td>20110914</td>
    </tr>
    <tr>
      <th>2</th>
      <td>cV358ssn7a0f7jZOwGNWS07wCKVqxyiImJUX6xcIwKw=</td>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>11</td>
      <td>20110915</td>
    </tr>
    <tr>
      <th>3</th>
      <td>9bzDeJP6sQodK73K5CBlJ6fgIQzPeLnRl0p5B77XP+g=</td>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>11</td>
      <td>20110915</td>
    </tr>
    <tr>
      <th>4</th>
      <td>WFLY3s7z4EZsieHCt63XrsdtfTEmJ+2PnnKLH5GY4Tk=</td>
      <td>6</td>
      <td>32</td>
      <td>female</td>
      <td>9</td>
      <td>20110915</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.tail()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>msno</th>
      <th>city</th>
      <th>bd</th>
      <th>gender</th>
      <th>registered_via</th>
      <th>registration_init_time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6769468</th>
      <td>VSGkb3hyBRUtb/b1MQUZbvOkktS3vKLnhMHW0CF8eyU=</td>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>7</td>
      <td>20151020</td>
    </tr>
    <tr>
      <th>6769469</th>
      <td>nWjH7glPkZ7jOVaCRwwjlpmp0T1hSWdv8hMJxiWCwKc=</td>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>7</td>
      <td>20151020</td>
    </tr>
    <tr>
      <th>6769470</th>
      <td>GH+b5+1tlv7ZZXsA8upBzVXMTLyffKcsF7WoU8b5rOI=</td>
      <td>15</td>
      <td>26</td>
      <td>female</td>
      <td>4</td>
      <td>20151020</td>
    </tr>
    <tr>
      <th>6769471</th>
      <td>XVlwT3fdCFGKqerEKBzUIjK+jzI6jzSke4cDMVhYyjE=</td>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>4</td>
      <td>20151020</td>
    </tr>
    <tr>
      <th>6769472</th>
      <td>isBt+JlgvZRNy6lxVr5vvuJ4lD00ofTaKyJ+uRnGcPg=</td>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>4</td>
      <td>20151021</td>
    </tr>
  </tbody>
</table>
</div>




```python
# Output file location
ref = '../../data/1-data_acquisition/1-members.output.zip'

# Compression options
compression_opts = dict(method='zip',
                        archive_name='1-members.output.csv')  
# Output data to zipped csv
df.to_csv(ref, index=False,
          compression=compression_opts)

# Cleanup unneeded files
os.remove('members_v3.csv.7z')
os.remove('members_v3.csv')
```

## Transactions


```python
# Downloads necessary file and extract
api.competition_download_file('kkbox-churn-prediction-challenge', 'transactions_v2.csv.7z')

with py7zr.SevenZipFile('transactions_v2.csv.7z', mode='r') as z:
    z.extractall()
```

      2%|█▋                                                                           | 1.00M/46.6M [00:00<00:05, 8.39MB/s]

    Downloading transactions_v2.csv.7z to C:\Users\thoma\projects\datascience\capstone-03\notebooks\1-data_acquisition
    

    100%|█████████████████████████████████████████████████████████████████████████████| 46.6M/46.6M [00:07<00:00, 6.96MB/s]
    

    
    


```python
# Read CSV into dataframe
df = pd.read_csv('data/churn_comp_refresh/transactions_v2.csv', low_memory=False)
```


```python
df.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>msno</th>
      <th>payment_method_id</th>
      <th>payment_plan_days</th>
      <th>plan_list_price</th>
      <th>actual_amount_paid</th>
      <th>is_auto_renew</th>
      <th>transaction_date</th>
      <th>membership_expire_date</th>
      <th>is_cancel</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>++6eU4LsQ3UQ20ILS7d99XK8WbiVgbyYL4FUgzZR134=</td>
      <td>32</td>
      <td>90</td>
      <td>298</td>
      <td>298</td>
      <td>0</td>
      <td>20170131</td>
      <td>20170504</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>++lvGPJOinuin/8esghpnqdljm6NXS8m8Zwchc7gOeA=</td>
      <td>41</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>1</td>
      <td>20150809</td>
      <td>20190412</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>+/GXNtXWQVfKrEDqYAzcSw2xSPYMKWNj22m+5XkVQZc=</td>
      <td>36</td>
      <td>30</td>
      <td>180</td>
      <td>180</td>
      <td>1</td>
      <td>20170303</td>
      <td>20170422</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>+/w1UrZwyka4C9oNH3+Q8fUf3fD8R3EwWrx57ODIsqk=</td>
      <td>36</td>
      <td>30</td>
      <td>180</td>
      <td>180</td>
      <td>1</td>
      <td>20170329</td>
      <td>20170331</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>+00PGzKTYqtnb65mPKPyeHXcZEwqiEzktpQksaaSC3c=</td>
      <td>41</td>
      <td>30</td>
      <td>99</td>
      <td>99</td>
      <td>1</td>
      <td>20170323</td>
      <td>20170423</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.tail()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>msno</th>
      <th>payment_method_id</th>
      <th>payment_plan_days</th>
      <th>plan_list_price</th>
      <th>actual_amount_paid</th>
      <th>is_auto_renew</th>
      <th>transaction_date</th>
      <th>membership_expire_date</th>
      <th>is_cancel</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1431004</th>
      <td>zwF50wwaJI2TBKWhB42HRBJ6EQK0jgSo1Xmwb9Jq3SU=</td>
      <td>32</td>
      <td>180</td>
      <td>536</td>
      <td>536</td>
      <td>0</td>
      <td>20170215</td>
      <td>20170817</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1431005</th>
      <td>zx/h5MzQQmsSat04wSfGpHp6N8aWLLwM1+7OV7ujmPY=</td>
      <td>41</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>1</td>
      <td>20170306</td>
      <td>20170406</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1431006</th>
      <td>zxvgjIKjy18Fm+cIWUfYKr68z09+ILBxuMW0DnbeUZ8=</td>
      <td>41</td>
      <td>30</td>
      <td>99</td>
      <td>99</td>
      <td>1</td>
      <td>20170308</td>
      <td>20170408</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1431007</th>
      <td>zzNhkExbpzmpjp9tXefiCUBtgNLgS+vZE7fFfTRDJVc=</td>
      <td>38</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>0</td>
      <td>20170318</td>
      <td>20170417</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1431008</th>
      <td>zzZmdSzz7J9oyC/5nHr/HBvWg6k+p2W15b6lt/VKUQE=</td>
      <td>32</td>
      <td>180</td>
      <td>699</td>
      <td>699</td>
      <td>0</td>
      <td>20161212</td>
      <td>20170613</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>




```python
# Output file location
ref = '../../data/1-data_acquisition/1-transactions.output.zip'

# Compression options
compression_opts = dict(method='zip',
                        archive_name='1-transactions.output.csv')  
# Output data to zipped csv
df.to_csv(ref, index=False,
          compression=compression_opts)

# Cleanup unneeded files
os.remove('transactions_v2.csv.7z')
shutil.rmtree('data')
```

## User Logs


```python
# Downloads necessary file and extract
api.competition_download_file('kkbox-churn-prediction-challenge', 'user_logs_v2.csv.7z')

with py7zr.SevenZipFile('user_logs_v2.csv.7z', mode='r') as z:
    z.extractall()
```

    user_logs_v2.csv.7z: Skipping, found more recently modified local copy (use --force to force download)
    


```python
# Read CSV into dataframe
df = pd.read_csv('data/churn_comp_refresh/user_logs_v2.csv', low_memory=False)
```


```python
df.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>msno</th>
      <th>date</th>
      <th>num_25</th>
      <th>num_50</th>
      <th>num_75</th>
      <th>num_985</th>
      <th>num_100</th>
      <th>num_unq</th>
      <th>total_secs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>u9E91QDTvHLq6NXjEaWv8u4QIqhrHk72kE+w31Gnhdg=</td>
      <td>20170331</td>
      <td>8</td>
      <td>4</td>
      <td>0</td>
      <td>1</td>
      <td>21</td>
      <td>18</td>
      <td>6309.273</td>
    </tr>
    <tr>
      <th>1</th>
      <td>nTeWW/eOZA/UHKdD5L7DEqKKFTjaAj3ALLPoAWsU8n0=</td>
      <td>20170330</td>
      <td>2</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>9</td>
      <td>11</td>
      <td>2390.699</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2UqkWXwZbIjs03dHLU9KHJNNEvEkZVzm69f3jCS+uLI=</td>
      <td>20170331</td>
      <td>52</td>
      <td>3</td>
      <td>5</td>
      <td>3</td>
      <td>84</td>
      <td>110</td>
      <td>23203.337</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ycwLc+m2O0a85jSLALtr941AaZt9ai8Qwlg9n0Nql5U=</td>
      <td>20170331</td>
      <td>176</td>
      <td>4</td>
      <td>2</td>
      <td>2</td>
      <td>19</td>
      <td>191</td>
      <td>7100.454</td>
    </tr>
    <tr>
      <th>4</th>
      <td>EGcbTofOSOkMmQyN1NMLxHEXJ1yV3t/JdhGwQ9wXjnI=</td>
      <td>20170331</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>112</td>
      <td>93</td>
      <td>28401.558</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.tail()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>msno</th>
      <th>date</th>
      <th>num_25</th>
      <th>num_50</th>
      <th>num_75</th>
      <th>num_985</th>
      <th>num_100</th>
      <th>num_unq</th>
      <th>total_secs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>18396357</th>
      <td>FGpiy2mB+vXLKziYRcY/xJcJEFJfRDfUqlU+p760f7E=</td>
      <td>20170314</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>248.058</td>
    </tr>
    <tr>
      <th>18396358</th>
      <td>iZRjKNMrw5ffEbfXODLhV/0tJLPbOH3am1WYDgqBf8Q=</td>
      <td>20170306</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>311.000</td>
    </tr>
    <tr>
      <th>18396359</th>
      <td>yztw4Y0EggG0w2wPkbMZx7ke7saSx7dLSfMheHZG/DQ=</td>
      <td>20170331</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>17</td>
      <td>1</td>
      <td>3973.189</td>
    </tr>
    <tr>
      <th>18396360</th>
      <td>swCHwkNx30/aENjq30qqaLlm7bUUytbMXdz1bH7g0Jk=</td>
      <td>20170307</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>179.278</td>
    </tr>
    <tr>
      <th>18396361</th>
      <td>pDQSIFZchNPmOproRzaNzy51/8yRXzLK3vvDXKzzGLQ=</td>
      <td>20170329</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>264.288</td>
    </tr>
  </tbody>
</table>
</div>




```python
# Output file location
ref = '../../data/1-data_acquisition/1-logs.output.zip'

# Compression options
compression_opts = dict(method='zip',
                        archive_name='1-logs.output.csv')  
# Output data to zipped csv
df.to_csv(ref, index=False,
          compression=compression_opts)

# Cleanup unneeded files
os.remove('user_logs_v2.csv.7z')
shutil.rmtree('data')
```

## Train


```python
# Downloads necessary file and extract
api.competition_download_file('kkbox-churn-prediction-challenge', 'train_v2.csv.7z')

with py7zr.SevenZipFile('train_v2.csv.7z', mode='r') as z:
    z.extractall()
```

    train_v2.csv.7z: Skipping, found more recently modified local copy (use --force to force download)
    


```python
# Read CSV into dataframe
df = pd.read_csv('data/churn_comp_refresh/train_v2.csv', low_memory=False)
```


```python
df.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>msno</th>
      <th>is_churn</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ugx0CjOMzazClkFzU2xasmDZaoIqOUAZPsH1q0teWCg=</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>f/NmvEzHfhINFEYZTR05prUdr+E+3+oewvweYz9cCQE=</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>zLo9f73nGGT1p21ltZC3ChiRnAVvgibMyazbCxvWPcg=</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>8iF/+8HY8lJKFrTc7iR9ZYGCG2Ecrogbc2Vy5YhsfhQ=</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>K6fja4+jmoZ5xG6BypqX80Uw/XKpMgrEMdG2edFOxnA=</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.tail()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>msno</th>
      <th>is_churn</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>970955</th>
      <td>OHnZbu+EVaP+vN7Z+OfT5OMcp90MWFZonmM0o3pb8FY=</td>
      <td>0</td>
    </tr>
    <tr>
      <th>970956</th>
      <td>S92bDK//uI6hk3u1vuApro0qJBQOToBozZ7lL1yTC+w=</td>
      <td>0</td>
    </tr>
    <tr>
      <th>970957</th>
      <td>eUa3xo16vpAjr43Cjlb6Kjf1NTILYyJIkBayJQdXWnw=</td>
      <td>0</td>
    </tr>
    <tr>
      <th>970958</th>
      <td>iZE41tbAQ65rJq60olkJT4BJzuUAYgQdfbEemXe/TTk=</td>
      <td>0</td>
    </tr>
    <tr>
      <th>970959</th>
      <td>oECkzJik4wKsbOEVY6UACLbmgM8qymFdb5cJaHrodY8=</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>




```python
# Output file location
ref = '../../data/1-data_acquisition/1-train.output.zip'

# Compression options
compression_opts = dict(method='zip',
                        archive_name='1-train.output.csv')  
# Output data to zipped csv
df.to_csv(ref, index=False,
          compression=compression_opts)

# Cleanup unneeded files
os.remove('train_v2.csv.7z')
shutil.rmtree('data')
```


```python

```
